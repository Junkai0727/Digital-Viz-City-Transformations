<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Point</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js"></script>
    <script charset="utf-8" src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/dimple/2.3.0/dimple.latest.min.js"
    ></script>
    <script type="text/javascript" src="https://lib.baomitu.com/echarts/4.9.0-rc.1/echarts.js"></script>
    <script type="text/javascript" src="./static/geojson.js"></script>
    <script type="text/javascript" src="./static/2017_1.js"></script>
    <script type="text/javascript" src="./static/2017_2.js"></script>
    <script type="text/javascript" src="./static/2017_3.js"></script>
    <script type="text/javascript" src="./static/2017_4.js"></script>
    <script type="text/javascript" src="./static/2018_1.js"></script>
    <script type="text/javascript" src="./static/2018_2.js"></script>
    <script type="text/javascript" src="./static/2018_3.js"></script>
    <script type="text/javascript" src="./static/2018_4.js"></script>
    <script type="text/javascript" src="./static/2019_1.js"></script>
    <script type="text/javascript" src="./static/2019_2.js"></script>
    <script type="text/javascript" src="./static/2019_3.js"></script>
    <script type="text/javascript" src="./static/2019_4.js"></script>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      #map {
        position: absolute;
        height: 100%;
        width: 100%;
        overflow: hidden;
      }

      .wrapper{
        position: absolute;
        padding: 10px;
        background: #fff;
        top: 20px;
        left: 20px;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <div class="wrapper">
      <div class="slider">
        <div>Quarter</div>
        <div class="slider-bar">
          <input style="width:200px" id='slider' type='range' min='1' max='12' step='1' value='1' list='tickmarks' />
          <span class="slider-value">2010</span>
        </div>
      </div>
      <div></div>
    </div>
    <script>

      const timeMapping = {
        1: '2017 - 1',
        2: '2017 - 2',
        3: '2017 - 3',
        4: '2017 - 4',
        5: '2018 - 1',
        6: '2018 - 2',
        7: '2018 - 3',
        8: '2018 - 4',
        9: '2019 - 1',
        10: '2019 - 2',
        11: '2019 - 3',
        12: '2019 - 4'
      };
      const dataMappging = {
        '2017 - 1': data2017_1,
        '2017 - 2': data2017_2,
        '2017 - 3': data2017_3,
        '2017 - 4': data2017_4,
        '2018 - 1': data2018_1,
        '2018 - 2': data2018_1,
        '2018 - 3': data2018_1,
        '2018 - 4': data2018_1,
        '2019 - 1': data2019_1,
        '2019 - 2': data2019_2,
        '2019 - 3': data2019_3,
        '2019 - 4': data2019_4
      };

      const App = {
        init: function () {
          this.Year = '2017 - 1';
          this.bindEvents();
          this.initMap();
        },
        initMap: function () {
          mapboxgl.accessToken =
            "pk.eyJ1IjoidWNmbmhlbiIsImEiOiJja2x1Njg1cjMwMWVpMm9xbHM1ZW00MG9sIn0.W-ZPMO8all-8rO3ahmwWMQ";
          this.map = new mapboxgl.Map({
            container: "map",
            style: "mapbox://styles/mapbox/light-v10",
            center: [-79.395954, 43.639832],
            zoom: 11,
            pitch: 0,
          });
          this.map.on('load',  () => {
            this.map.addSource('mapjson', {
              type: "geojson",
              data:  geojson 
            });
            this.map.addLayer({
              'id': 'maine',
              'type': 'fill',
              'source': 'mapjson',
              'layout': {},
              'paint': {
              'fill-color': '#0080ff',
              'fill-opacity': 0.5
              }
            });
            this.map.addSource(`data${this.Year}`, {
              type: "geojson",
              data:  data2017_1
            });

            this.map.addLayer({
                id: `data${this.Year}`,
                source: `data${this.Year}`,
                type: "circle",
                paint: {
                  "circle-radius": 2.5,
                  "circle-color": {
                    "property": "num",
                    "stops": [
                      [100, "#fff5f0"],
                      [200, "#fee0d2"],
                      [300, "#fcbba1"],
                      [400, "#fc9272"],
                      [500, "#fb6a4a"],
                      [600, "#ef3b2c"],
                      [700, "#cb181d"],
                      [800, "#a50f15"],
                      [900, "#67000d"]
                    ]
                  },
                  "circle-stroke-width": 1,
                  "circle-stroke-color": "#000"
                },
              });
          });
        },
        removeLayer: function (){
          if (this.map.getLayer(`data${this.Year}`)) {
            this.map.removeLayer(`data${this.Year}`);
          }
          if (this.map.getSource(`data${this.Year}`)) {
            this.map.removeSource(`data${this.Year}`);
          }
        },
        addLayer: function () {
          this.map.addSource(`data${this.Year}`, {
            type: "geojson",
            data:  dataMappging[this.Year]
          });
          this.map.addLayer({
            id: `data${this.Year}`,
            source: `data${this.Year}`,
            type: "circle",
            paint: {
              "circle-radius": 2.5,
              "circle-color": {
                "property": "num",
                "stops": [
                  [100, "#fff5f0"],
                  [200, "#fee0d2"],
                  [300, "#fcbba1"],
                  [400, "#fc9272"],
                  [500, "#fb6a4a"],
                  [600, "#ef3b2c"],
                  [700, "#cb181d"],
                  [800, "#a50f15"],
                  [900, "#67000d"]
                ]
              },
              "circle-stroke-width": 1,
              "circle-stroke-color": "#000"
            },
          });
        },
        bindEvents: function () {
          document.getElementById("slider").addEventListener("input", (e) => {
            $(".slider-value").html(timeMapping[e.target.value]);
            this.removeLayer();
            this.Year = timeMapping[e.target.value];
            this.addLayer();
          });
        },
      };
      App.init();
    </script>
  </body>
</html>
